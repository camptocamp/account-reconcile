<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="assets_common" inherit_id="report.assets_common">
        <xpath expr="." position="inside">
            <style type="text/css">
                .dispatch {
                    width: 100%;
                }
                table.dispatch td {
                    text-align: center;
                }
                table.pack {
                    text-align: left;
                    width: 96%;
                    margin-left: 15px;
                    margin-top: 30px;
                    border-collapse: collapse;
                }
                table.pack caption {
                    text-align: left;
                    margin-left: -15px;
                    font-weight: bold;
                }
                table.pack td {
                    border-bottom: 1px solid;
                }
            </style>
        </xpath>
    </template>

    <template id="report_batch_picking" inherit_id="stock_batch_picking.report_batch_picking">
        <t t-call="report.external_layout" position="after">
            <t t-call="report.external_layout">
                <div class="page">
                    <div class="row mt32 mb32">
                        <div class="col-xs-3">
                            <strong>Date:</strong>
                            <span t-esc="formatLang(time.strftime('%Y-%m-%d'), date=True)"/>
                        </div>
                        <div class="col-xs-3" style="float: right">
                            <strong>Printed by:</strong>
                            <span t-field="user.name"/>
                        </div>
                    </div>

                    <t t-foreach="docs" t-as="doc">
                        <table class="dispatch">
                            <tr>
                                <td>
                                    <h2>
                                        <span t-esc="doc.batch_name"/>
                                    </h2>
                                </td>
                            </tr>
                            <tr>
                                <td>Picked by:
                                    <span t-esc="doc.batch_id.picker_id.name"/>
                                </td>
                            </tr>
                        </table>

                        <p t-esc="doc.batch_notes"/>

                        <div class="mb32">
                            <t t-foreach="get_packs(doc)" t-as="pack_data">
                                <t t-set="pack" t-value="pack_data[0]"/>
                                <t t-set="operations" t-value="pack_data[1]"/>

                                <table class="pack">
                                    <t t-if="pack">
                                        <caption t-esc="pack.parcel_tracking"/>
                                    </t>
                                    <t t-if="not pack">
                                        <caption>Not in a pack</caption>
                                    </t>
                                    <t t-foreach="operations" t-as="op">
                                        <t t-if="op.product_id">
                                            <tr align="left">
                                                <td width="16%">
                                                    <span t-esc="op.product_id.default_code"/>
                                                </td>
                                                <td width="18%">
                                                    <span t-esc="op.product_id.name"/>
                                                </td>
                                                <td width="12%">
                                                    <span t-esc="get_variants(op.product_id)"/>
                                                </td>
                                                <td width="24%">
                                                    <span t-esc="op.location_id.complete_name"/>
                                                </td>
                                                <td width="10%">
                                                    <span t-esc="op.picking_id.origin"/>
                                                </td>
                                                <td width="10%">
                                                    <span t-esc="op.product_qty"/>
                                                    <span t-esc="op.product_uom_id.name"/>
                                                </td>
                                                <td width="8%">
                                                    <span t-esc="op.picking_id.state"/>
                                                </td>
                                            </tr>
                                        </t>
                                        <t t-if="not op.product_id and op.package_id">
                                            <t t-foreach="op.package_id.quant_ids" t-as="quant">
                                                <tr align="left">
                                                    <td width="16%">
                                                        <span t-esc="quant.product_id.default_code"/>
                                                    </td>
                                                    <td width="18%">
                                                        <span t-esc="quant.product_id.name"/>
                                                    </td>
                                                    <td width="12%">
                                                        <span t-esc="get_variants(quant.product_id)"/>
                                                    </td>
                                                    <td width="24%">
                                                        <span t-esc="op.location_id.complete_name"/>
                                                    </td>
                                                    <td width="10%">
                                                        <span t-esc="op.picking_id.origin"/>
                                                    </td>
                                                    <td width="10%">
                                                        <span t-esc="quant.qty"/>
                                                        <span t-esc="quant.product_uom_id.name"/>
                                                    </td>
                                                    <td width="8%">
                                                        <span t-esc="op.picking_id.state"/>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </t>
                                </table>
                            </t>
                        </div>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>
