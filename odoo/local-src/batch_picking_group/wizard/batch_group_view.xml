<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Wizard form -->
  <record id="view_batch_picking_group" model="ir.ui.view">
    <field name="name">stock.batch.picking.group.form</field>
    <field name="model">stock.batch.picking.group</field>
    <field name="arch" type="xml">
      <form string="Generate Grouped Batches">
        <notebook>
          <page string="Options">
            <group string="Name" col="4">
              <field name="suffix"/>
            </group>
            <group string="Limit per Dispatch" col="4">
              <field name="pack_limit"/>
              <field name="pack_limit_apply_threshold"
                attrs="{'invisible': [('pack_limit', '&lt;', 1)]}"/>
              <p colspan="4" class="oe_grey" attrs="{'invisible': [('pack_limit', '&lt;', 1)]}">
                The generated batches will not contain more packs than the limit.
                <span attrs="{'invisible': [('pack_limit_apply_threshold', '=', False)]}">
                  The limit is applied excepted for packs with only 1 unit.
                </span>
                <span attrs="{'invisible': [('pack_limit_apply_threshold', '=', True)]}">
                  The limit is applied even for packs with only 1 unit.
                </span>
              </p>
              <p colspan="4" class="oe_grey" attrs="{'invisible': [('pack_limit', '&gt;=', 1)]}">
                The generated batches will contain an unlimited number of packs.
              </p>
            </group>
            <group string="Grouping" col="4">
              <field name="group_by_content" colspan="4" />
              <p colspan="4" class="oe_grey" attrs="{'invisible': [('group_by_content', '=', False)]}">
                The packs with identical content will be grouped in the same batch.
              </p>
              <p colspan="4" class="oe_grey" attrs="{'invisible': [('group_by_content', '=', True)]}">
                The packs will not be grouped according to their content, the batches
                will contain various packs.
              </p>
              <field name="group_leftovers"
                attrs="{'invisible': [('group_by_content', '=', False)]}"/>
              <field name="group_leftovers_threshold"
                attrs="{'invisible': ['|', ('group_leftovers', '=', False), ('group_by_content', '=', False)]}"/>
              <p colspan="4" class="oe_grey" attrs="{'invisible': [('group_by_content', '=', False)]}">
                Leftovers are batches generated with a number of packs below a defined threshold.
                <span attrs="{'invisible': [('group_leftovers', '=', False)]}">
                  The leftovers will all be grouped in a final batches.
                </span>
                <span attrs="{'invisible': [('group_leftovers', '=', True)]}">
                  The leftovers will not be grouped.
                </span>
                <span attrs="{'invisible': [('group_leftovers', '=', False)]}">
                  Dispatches are considered as leftovers when they contains less that the Threshold
                </span>
              </p>
            </group>
          </page>
          <page string="Filter Products">
            <group>
              <field colspan="2" name="only_product_ids" nolabel="1" />
            </group>
          </page>
        </notebook>
        <footer>
          <button name="group" string="Generate Batches" type="object" class="oe_highlight"/>
          or
          <button string="Cancel" class="oe_link" special="cancel"/>
        </footer>
      </form>
    </field>
  </record>

  <!-- Open wizard action -->
  <record id="action_batch_picking_group" model="ir.actions.act_window">
    <field name="name">Generate Grouped Batches</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">stock.batch.picking.group</field>
    <field name="view_type">form</field>
    <field name="view_mode">form</field>
    <field name="view_id" ref="view_batch_picking_group"/>
    <field name="target">new</field>
  </record>

  <!-- Wizard button in stock.picking -->
  <record model="ir.values" id="stock_picking_batch_picking_group">
    <field name="model_id" ref="stock.model_stock_picking" />
    <field name="name">Generate Grouped Batches</field>
    <field name="key2">client_action_multi</field>
    <field name="value" eval="'ir.actions.act_window,' + str(ref('action_batch_picking_group'))" />
    <field name="key">action</field>
    <field name="model">stock.picking</field>
  </record>

  <!-- Wizard button in stock.package -->
  <record model="ir.values" id="stock_package_batch_picking_group">
    <field name="model_id" ref="stock.model_stock_quant_package" />
    <field name="name">Generate Grouped Batches</field>
    <field name="key2">client_action_multi</field>
    <field name="value" eval="'ir.actions.act_window,' + str(ref('action_batch_picking_group'))" />
    <field name="key">action</field>
    <field name="model">stock.quant.package</field>
  </record>
</odoo>
