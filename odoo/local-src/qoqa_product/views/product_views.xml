<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="product_template_form_view" model="ir.ui.view">
    <field name="name">product.template.common.form</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_form_view"/>
    <field name="arch" type="xml">
      <div name="options" position="inside">
        <div>
          <field name="is_wine"/>
          <label for="is_wine"/>
        </div>
        <div>
          <field name="is_liquor"/>
          <label for="is_liquor"/>
        </div>
      </div>
      <xpath expr="//notebook" position="inside">
        <page string="Wine / Liquor" name="wine_liquor"
          attrs="{'invisible': [('is_wine', '=', False), ('is_liquor', '=', False)]}">

          <group string="General">
            <field name="winemaker_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="appellation" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="millesime"/>
            <field name="country_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="wine_bottle_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
          </group>

          <group attrs="{'invisible': [('is_wine', '=', False)]}" string="Wine">
            <field name="wine_short_name"/>
            <field name="wine_region"/>
            <field name="wine_type_id" attrs="{'required': [('is_wine', '=', True)]}"/>
            <field name="wine_class_id" attrs="{'required': [('is_wine', '=', True)]}"/>
          </group>

          <group attrs="{'invisible': [('is_liquor', '=', False)]}" string="Liquor">
            <field name="ageing"/>
            <field name="abv"/>
          </group>

        </page>
      </xpath>
    </field>
  </record>

  <record id="product_template_search_view" model="ir.ui.view">
    <field name="name">product.template.search</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_search_view"/>
    <field name="arch" type="xml">
      <filter name="filter_to_sell" position="after">
        <filter string="Wine" name="is_wine" domain="[('is_wine', '=', True)]"/>
        <filter string="Liquor" name="is_liquor" domain="[('is_liquor', '=', True)]"/>
      </filter>
    </field>
  </record>

  <record id="product_variant_easy_edit_view" model="ir.ui.view">
    <field name="name">product.product.view.form.easy</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_variant_easy_edit_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>
    </field>
  </record>

  <record id="product_normal_form_view" model="ir.ui.view">
    <field name="name">product.product.form</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_normal_form_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>
    </field>
  </record>

  <record id="view_product_variant_tree_brand" model="ir.ui.view">
    <field name="name">product.product.tree</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product_brand.view_product_variant_tree_brand"/>
    <field name="arch" type="xml">
      <field name="barcode" position="replace">
      </field>
      <field name="name" position="after">
        <field name="barcode"/>
      </field>
    </field>
  </record>
  <!--

  They want to be able to edit some fields in the tree view,
  so we activate the editable mode. However, when we activate
  the editable mode, we cannot anymore reach the form view.

  So we make a copy of the view (primary mode) and we add a new
  action / menu.

  -->
  <record id="product_product_tree_inline_edit_view" model="ir.ui.view">
    <field name="name">product.product.tree</field>
    <field name="model">product.product</field>
    <field name="mode">primary</field>
    <field name="priority" eval="50"/>
    <field name="inherit_id" ref="view_product_variant_tree_brand"/>
    <field name="arch" type="xml">
      <tree position="attributes">
        <attribute name="editable">top</attribute>
      </tree>
      <field name="attribute_value_ids" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="state" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="lst_price" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="uom_id" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="product_brand_id" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
    </field>
  </record>

  <record id="product_search_form_view" model="ir.ui.view">
    <field name="name">product.search.form</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_search_form_view"/>
    <field name="arch" type="xml">
      <field name="name" position="after">
        <field name="barcode"/>
      </field>
    </field>
  </record>

  <record id="product_product_edit_tree_view" model="ir.actions.act_window">
      <field name="name">Product Variants (List)</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">product.product</field>
      <field name="view_mode">tree</field>
      <field name="view_type">form</field>
      <field name="context">{"search_default_filter_to_sell":1}</field>
      <field name="view_id" ref="product_product_tree_inline_edit_view"/>
      <field name="search_view_id" ref="product.product_search_form_view"/>
  </record>

  <record id="edit_product_variant_action" model="ir.actions.act_window">
    <field name="name">Product Variants</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">product.product</field>
    <field name="context">{'search_default_product_tmpl_id': [active_id], 'default_product_tmpl_id': active_id}</field>
    <field name="search_view_id" ref="product_search_form_view"/>
    <field name="view_ids"
      eval="[(5, 0, 0),
      (0, 0, {'view_mode': 'tree', 'view_id': ref('product_product_tree_inline_edit_view')}),
      (0, 0, {'view_mode': 'form', 'view_id': ref('product_variant_easy_edit_view')}),
      (0, 0, {'view_mode': 'kanban'})]"/>
    <field name="help" type="html">
      <p class="oe_view_nocontent_create">
        Click to define a new product.
        </p><p>
        You must define a product for everything you sell, whether it's
        a physical product, a consumable or a service you offer to
        customers.
        </p><p>
        The product form contains information to simplify the sale
        process: price, notes in the quotation, accounting data,
        procurement methods, etc.
      </p>
    </field>
  </record>

  <menuitem id="menu_product_product_edit_tree_view"
    action="product_product_edit_tree_view"
    parent="base.menu_sales" groups="product.group_product_variant" sequence="100"/>

  <record id="product_template_only_form_view" model="ir.ui.view">
    <field name="name">product.template.product.form</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_only_form_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>

      <field name="attribute_id" position="before">
        <field name="sequence" widget="handle" />
      </field>

      <xpath expr="//field[@name='product_variant_count']//ancestor::button" position="after">
        <button name="%(qoqa_product.edit_product_variant_action)d" type="action"
          icon="fa-sitemap" class="oe_stat_button"
          attrs="{'invisible': [('product_variant_count', '&lt;=', 1)]}"
          groups="product.group_product_variant"
          string="Variantes : Ã©dition rapide">
        </button>
      </xpath>

      <xpath expr="//page[@name='variants']//field[@name='attribute_line_ids']" position="before">
        <group>
          <field name="base_default_code"/>
        </group>
      </xpath>

      <xpath expr="//page[@name='variants']//field[@name='attribute_line_ids']" position="after">
        <group>
          <field name="attribute_value_code_ids" widget="one2many_list" nolabel="1">
            <tree string="Variant Codes" editable="bottom" create="0">
              <field name="value_id" readonly="1"/>
              <field name="code"/>
            </tree>
          </field>
        </group>
        <button name="create_variant_ids" type="object" string="Compute All Variants" class="oe_read_only"/>
      </xpath>
    </field>
  </record>

</odoo>
