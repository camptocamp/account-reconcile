<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="product_template_form_view" model="ir.ui.view">
    <field name="name">product.template.common.form</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_form_view"/>
    <field name="arch" type="xml">
      <div name="options" position="inside">
        <div>
          <field name="is_wine"/>
          <label for="is_wine"/>
        </div>
        <div>
          <field name="is_liquor"/>
          <label for="is_liquor"/>
        </div>
      </div>
      <xpath expr="//notebook" position="inside">
        <page string="Wine / Liquor" name="wine_liquor"
          attrs="{'invisible': [('is_wine', '=', False), ('is_liquor', '=', False)]}">

          <group string="General">
            <field name="winemaker_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="appellation" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="millesime"/>
            <field name="country_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
            <field name="wine_bottle_id" attrs="{'required': ['|', ('is_wine', '=', True), ('is_liquor', '=', True)]}"/>
          </group>

          <group attrs="{'invisible': [('is_wine', '=', False)]}" string="Wine">
            <field name="wine_short_name"/>
            <field name="wine_region"/>
            <field name="wine_type_id" attrs="{'required': [('is_wine', '=', True)]}"/>
            <field name="wine_class_id" attrs="{'required': [('is_wine', '=', True)]}"/>
          </group>

          <group attrs="{'invisible': [('is_liquor', '=', False)]}" string="Liquor">
            <field name="ageing"/>
            <field name="abv"/>
          </group>

        </page>
      </xpath>
    </field>
  </record>

  <record id="product_template_search_view" model="ir.ui.view">
    <field name="name">product.template.search</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_search_view"/>
    <field name="arch" type="xml">
      <filter name="filter_to_sell" position="after">
        <filter string="Wine" name="is_wine" domain="[('is_wine', '=', True)]"/>
        <filter string="Liquor" name="is_liquor" domain="[('is_liquor', '=', True)]"/>
      </filter>
    </field>
  </record>

  <record id="product_variant_easy_edit_view" model="ir.ui.view">
    <field name="name">product.product.view.form.easy</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_variant_easy_edit_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>
    </field>
  </record>

  <record id="product_template_only_form_view" model="ir.ui.view">
    <field name="name">product.template.product.form</field>
    <field name="model">product.template</field>
    <field name="inherit_id" ref="product.product_template_only_form_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>

      <xpath expr="//page[@name='variants']//field[@name='attribute_line_ids']" position="before">
        <group>
          <field name="base_default_code"/>
        </group>
      </xpath>
    </field>
  </record>

  <record id="product_normal_form_view" model="ir.ui.view">
    <field name="name">product.product.form</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_normal_form_view"/>
    <field name="arch" type="xml">
      <field name="default_code" position="attributes">
        <attribute name="required">True</attribute>
      </field>
    </field>
  </record>

  <record id="view_product_variant_tree_brand" model="ir.ui.view">
    <field name="name">product.product.tree</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product_brand.view_product_variant_tree_brand"/>
    <field name="arch" type="xml">
      <field name="barcode" position="replace">
      </field>
      <field name="name" position="after">
        <field name="barcode"/>
      </field>
    </field>
  </record>
  <!--

  They want to be able to edit some fields in the tree view,
  so we activate the editable mode. However, when we activate
  the editable mode, we cannot anymore reach the form view.

  So we make a copy of the view (primary mode) and we add a new
  action / menu.

  -->
  <record id="product_product_tree_inline_edit_view" model="ir.ui.view">
    <field name="name">product.product.tree</field>
    <field name="model">product.product</field>
    <field name="mode">primary</field>
    <field name="priority" eval="50"/>
    <field name="inherit_id" ref="view_product_variant_tree_brand"/>
    <field name="arch" type="xml">
      <tree position="attributes">
        <attribute name="editable">top</attribute>
      </tree>
      <field name="attribute_value_ids" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="state" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="lst_price" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="uom_id" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
      <field name="product_brand_id" position="attributes">
        <attribute name="readonly">1</attribute>
      </field>
    </field>
  </record>

  <record id="product_product_edit_tree_view" model="ir.actions.act_window">
      <field name="name">Product Variants (List)</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">product.product</field>
      <field name="view_mode">tree</field>
      <field name="view_type">form</field>
      <field name="context">{"search_default_filter_to_sell":1}</field>
      <field name="view_id" ref="product_product_tree_inline_edit_view"/>
      <field name="search_view_id" ref="product.product_search_form_view"/>
  </record>

  <record id="product_search_form_view" model="ir.ui.view">
    <field name="name">product.search.form</field>
    <field name="model">product.product</field>
    <field name="inherit_id" ref="product.product_search_form_view"/>
    <field name="arch" type="xml">
      <field name="name" position="after">
        <field name="barcode"/>
      </field>
    </field>
  </record>

  <menuitem id="menu_product_product_edit_tree_view"
    action="product_product_edit_tree_view"
    parent="base.menu_sales" groups="product.group_product_variant" sequence="100"/>

</odoo>
