migration:
  options:
    install_command: odoo.py
    # Workaround for https://github.com/odoo/odoo/pull/12730
    # Please remove once merged.
    # Warning: the DEMO flag will never be considered as we force
    # the 'without demo' mode
    install_args: --without-demo=all
  versions:
    - version: 9.1.0
      operations:
        pre:
          - "sh -c 'PGPASSWORD=$DB_PASSWORD psql -h db -U $DB_USER -c \"CREATE EXTENSION IF NOT EXISTS pg_trgm;\" $DB_NAME'"
      addons:
        upgrade:
          - account
          - base_import
          - document
          - stock
          - sale
          - l10n_ch
          - l10n_fr
          - l10n_multilang
          #---- odoo/enterprise ----------------------------#
          - stock_barcode
          # old official modules
          #- multi_company
          #---- OCA/account-financial-reporting ------------#
          #- account_export_csv
          #- account_financial_report_webkit
          #---- OCA/account-financial-tools ----------------#
          #- account_constraints
          #- account_default_draft_move
          - account_permanent_lock_move
          #- account_reversal
          #- currency_rate_update
          #---- OCA/account-fiscal-rule --------------------#
          #- account_fiscal_position_rule
          #- account_fiscal_position_rule_sale
          #---- OCA/bank-payment ---------------------------#
          - account_payment_mode
          - account_payment_sale
          #---- OCA/bank-statement-reconcile ---------------#
          - account_mass_reconcile
          - account_move_base_import
          - account_move_transactionid_import
          - base_transaction_id
          #---- OCA/carrier-delivery -----------------------#
          - base_delivery_carrier_label
          - delivery_carrier_label_batch
          - delivery_carrier_label_postlogistics
          - delivery_carrier_label_postlogistics_shop_logo
          #---- OCA/connector-ecommerce --------------------#
          - connector_ecommerce
          #---- OCA/crm ------------------------------------#
          - crm_claim_merge
          #---- OCA/l10n-france ----------------------------#
          #- l10n_fr_rib
          #---- OCA/l10n-switzerland -----------------------#
          - l10n_ch_bank
          - l10n_ch_base_bank
          - l10n_ch_dta
          - l10n_ch_payment_slip
          - l10n_ch_zip
          #---- OCA/product-attributes ---------------------#
          - product_brand
          #---- OCA/purchase-workflow ----------------------#
          - purchase_discount
          #---- OCA/rma ------------------------------------#
          - crm_claim_rma
          - crm_rma_stock_location
          #---- OCA/sale-reporting -------------------------#
          #- sale_jit_on_services
          #---- OCA/sale-workflow  -------------------------#
          - sale_automatic_workflow
          - sale_automatic_workflow_payment_mode
          #---- OCA/server-tools ---------------------------#
          - mass_editing
          - mail_cleanup
          - mail_environment
          - base_technical_features
          #---- OCA/stock-logistics-warehouse --------------#
          - stock_orderpoint_generator
          #---- OCA/stock-logistics-workflow ---------------#
          - stock_batch_picking
          - stock_picking_mass_assign
          #---- OCA/web ------------------------------------#
          - web_send_message_popup
          #- web_translate_dialog
          #---- QoQa specifics -----------------------------#
          - base_stock_picking_pack_split
          - account_s3_move_import
          - connector_qoqa
          - crm_claim_mail
          - crm_rma_by_shop
          - delivery_carrier_label_swiss_pp
          - delivery_carrier_url
          - ecotax
          #- picking_dispatch_delay_done
          #- picking_dispatch_group
          - purchase_variant_fast_entry
          - qoqa_base_data
          - qoqa_claim
          - qoqa_claim_unclaimed_process
          #- qoqa_label_dispatch_pack_split
          - qoqa_offer
          - qoqa_product
          - qoqa_record_archiver
          - server_env_connector_qoqa
          - specific_fct
          #- specific_report
          - speedy_views
          #- web_custom
          - web_environment
          - wine_ch_report
      modes:
        migration:
          operations:
            pre:
              # we execute a cleaning query before running
              # anthem otherwise the import of openerp
              # will issue a lot of warnings
              - "sh -c 'PGPASSWORD=$DB_PASSWORD psql -h db -U $DB_USER -f songs/migration/clean.sql $DB_NAME'"
              - anthem songs.migration.pre::main
            post:
              - anthem songs.migration.post::main
        demo:
          operations:
            post:
              - anthem songs.install.demo::main
    - version: 9.2.0
      # nothing to do, all has been migrated in 9.1.0
