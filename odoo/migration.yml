migration:
  options:
    install_command: odoo.py
    # Workaround for https://github.com/odoo/odoo/pull/12730
    # Please remove once merged.
    # Warning: the DEMO flag will never be considered as we force
    # the 'without demo' mode
    install_args: --without-demo=all --load=web,web_kanban,session_redis,attachment_s3,logging_json
  versions:
    - version: 9.1.0
      operations:
        pre:
          - "sh -c 'PGPASSWORD=$DB_PASSWORD psql -h db -U $DB_USER -c \"CREATE EXTENSION IF NOT EXISTS pg_trgm;\" $DB_NAME'"
        post:
          - anthem songs.install.setup_platform::main
      addons:
        upgrade:
          - account
          - base_import
          - document
          - stock
          - sale
          - purchase
          - l10n_ch
          - l10n_fr
          - l10n_multilang
          #---- odoo/enterprise ----------------------------#
          - stock_barcode
          # old official modules
          #- multi_company
          #---- OCA/account-financial-reporting ------------#
          #- account_export_csv
          #- account_financial_report_webkit
          - account_financial_report_qweb
          #---- OCA/account-financial-tools ----------------#
          #- account_constraints
          #- account_default_draft_move
          - account_permanent_lock_move
          #- account_reversal
          - currency_rate_update
          #---- OCA/account-fiscal-rule --------------------#
          #- account_fiscal_position_rule
          #- account_fiscal_position_rule_sale
          #---- OCA/bank-payment ---------------------------#
          - account_payment_mode
          - account_payment_sale
          #---- OCA/bank-statement-reconcile ---------------#
          - account_mass_reconcile
          - account_mass_reconcile_ref_deep_search
          - account_mass_reconcile_transaction_ref
          - account_move_base_import
          - account_move_so_import
          - account_move_transactionid_import
          - base_transaction_id
          #---- OCA/carrier-delivery -----------------------#
          - base_delivery_carrier_label
          - delivery_carrier_label_batch
          - delivery_carrier_label_default
          - delivery_carrier_label_postlogistics
          - delivery_carrier_label_postlogistics_shop_logo
          #---- OCA/connector-ecommerce --------------------#
          - connector_ecommerce
          #---- OCA/crm ------------------------------------#
          - crm_claim_merge
          #---- OCA/l10n-france ----------------------------#
          #- l10n_fr_rib
          #---- OCA/l10n-switzerland -----------------------#
          - l10n_ch_bank
          - l10n_ch_base_bank
          - l10n_ch_dta
          - l10n_ch_pain_base
          - l10n_ch_pain_credit_transfer
          - l10n_ch_payment_slip
          - l10n_ch_zip
          #---- OCA/product-attributes ---------------------#
          - product_brand
          #---- OCA/purchase-workflow ----------------------#
          - purchase_discount
          #---- OCA/reporting-engine -----------------------#
          - report_custom_filename
          #---- OCA/rma ------------------------------------#
          - crm_claim_rma
          - crm_rma_stock_location
          #---- OCA/sale-reporting -------------------------#
          #- sale_jit_on_services
          #---- OCA/sale-workflow  -------------------------#
          - sale_automatic_workflow
          - sale_automatic_workflow_payment_mode
          #---- OCA/server-tools ---------------------------#
          - mass_editing
          - mail_cleanup
          - mail_environment
          - base_technical_features
          #---- OCA/stock-logistics-warehouse --------------#
          - stock_orderpoint_generator
          #---- OCA/stock-logistics-workflow ---------------#
          - stock_batch_picking
          - stock_picking_mass_assign
          #---- OCA/web ------------------------------------#
          - web_hide_db_manager_link
          - web_send_message_popup
          #- web_translate_dialog
          #---- Odoo Monitoring ----------------------------#
          - monitoring_log_requests
          #---- QoQa specifics -----------------------------#
          - account_bank_statement_import_camt
          - base_stock_picking_pack_split
          - batch_picking_delay_done
          - batch_picking_group
          - account_s3_move_import
          - connector_qoqa
          - crm_claim_mail
          - crm_rma_by_shop
          - delivery_carrier_label_swiss_pp
          - delivery_carrier_url
          - ecotax
          - purchase_variant_fast_entry
          - qoqa_base_data
          - qoqa_claim
          - qoqa_claim_unclaimed_process
          - qoqa_offer
          - qoqa_product
          - qoqa_record_archiver
          - server_env_connector_qoqa
          - specific_enterprise_report
          - specific_fct
          - specific_report
          - speedy_views
          - web_environment
          - wine_ch_report
          - cloud_platform
      modes:
        migration:
          operations:
            pre:
              # we execute a cleaning query before running
              # anthem otherwise the import of openerp
              # will issue a lot of warnings
              - "sh -c 'psql -f odoo/songs/migration/clean.sql'"
              - "sh -c 'psql -q -f odoo/songs/migration/migrate_res_bank_xml_ids.sql'"
              - anthem songs.migration.pre::main
            post:
              - anthem songs.migration.post::main
        demo:
          operations:
            post:
              - anthem songs.install.demo::main
    - version: 9.2.0
      # nothing to do, all has been migrated in 9.1.0
    - version: 9.3.0
      # nothing to do, all has been migrated in 9.1.0
    - version: 9.3.1
      # nothing to do, all has been migrated in 9.1.0
    - version: 9.4.0
      # nothing to do, all has been migrated in 9.1.0
    - version: 9.5.0
    - version: 9.6.0
    - version: 9.6.1
    - version: 9.7.0
    - version: 9.7.1
    - version: 9.8.0
    - version: 9.9.0
    - version: 9.10.0
    - version: 9.11.0
    - version: 9.12.0
    - version: 9.13.0
    - version: 9.14.0
    - version: 9.15.0
    - version: 9.16.0
    - version: 9.17.0
    - version: 9.18.0
    - version: 9.19.0
    - version: 9.20.0
    - version: 9.21.0
    - version: 9.22.0
    - version: 9.23.0
    - version: 9.24.0
    - version: 9.24.1
    - version: 9.24.2
    - version: 9.24.3
    - version: 9.24.4
    - version: 9.24.5
    - version: 9.24.6
    - version: 9.24.7
      addons:
        upgrade:
          - specific_fct
          - crm_claim_mail
          - qoqa_claim
    - version: 9.24.8
    - version: 9.24.9
    - version: 9.24.10
    - version: 9.24.11
    - version: 9.24.12
    - version: 9.24.13
    - version: 9.25.0
      operations:
        post:
          - anthem songs.upgrade.9_25_0::main
      addons:
        upgrade:
          - qoqa_product
    - version: 9.26.0
      operations:
        post:
          - anthem songs.upgrade.9_26_0::main
      addons:
        upgrade:
          - delivery_carrier_label_swiss_pp
          - qoqa_claim_unclaimed_process
    - version: 9.26.1
      addons:
        upgrade:
          - batch_picking_group
    - version: 9.27.0
      operations:
        post:
          - anthem songs.upgrade.9_27_0::main
      addons:
        upgrade:
          - specific_fct
          - specific_report
    - version: 9.27.1
    - version: 9.27.2
    - version: 9.28.0
      operations:
        post:
          - anthem songs.upgrade.9_28_0::main
      addons:
        upgrade:
          - specific_fct
          - batch_picking_group
          - qoqa_product
    - version: 9.29.0
      addons:
        upgrade:
    - version: 9.30.0
      operations:
        pre:
          - anthem songs.upgrade.9_30_0::main
      addons:
        upgrade:
          # OCA/bank-payment
          - account_payment_order
          - specific_fct
          - qoqa_mail_message
          - account_mass_reconcile
          - batch_picking_group

    - version: 9.31.0
      addons:
        upgrade:
          - batch_picking_group
          - account_payment_order

    - version: 9.31.1
      addons:
        upgrade:
          - batch_picking_group

    - version: 9.31.2
      addons:
        upgrade:
          - batch_picking_group
    - version: 9.32.0
      addons:
        upgrade:
          - speedy_views
