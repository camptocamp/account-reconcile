<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_sales_offer_filter" model="ir.ui.view">
            <field name="name">qoqa.offer.list.select</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <search string="Search Sales Offer">
                    <field name="name" string="Offer"/>
                    <field name="ref" string="Ref"/>
                    <field name="title" string="Title"/>
                    <field name="qoqa_shop_id" widget="selection"/>
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <filter icon="terp-mail-message-new"
                        string="Unread Messages" name="message_unread"
                        domain="[('message_unread', '=', True)]"/>
                    <separator/>

                    <filter
                        string="Current"
                        name="current"
                        domain="[('datetime_begin_filter', '&lt;=', time.strftime('%%Y-%%m-%%d %%H:%%M:%%S')),
                                 ('datetime_end_filter', '&gt;=', time.strftime('%%Y-%%m-%%d %%H:%%M:%%S')),
                                   ]"
                        help="Current Offers!"/>
                    <filter
                        string="+- 2 days"
                        name="in2days"
                        domain="['|',
                                 ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=2)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=2)).strftime('%%Y-%%m-%%d')),
                                 '|',
                                 ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=2)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=2)).strftime('%%Y-%%m-%%d')),
                                 ]"
                        help="Offers +- 2 days"/>
                    <filter
                        string="+- 10 days"
                        name="in10days"
                        domain="['|',
                                 ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 '|',
                                 ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ]"
                        help="Offers +- 10 days"/>
                    <filter
                        string="+- 30 days"
                        name="in30days"
                        domain="['|',
                                 ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 '|',
                                 ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ]"
                        help="Offers +- 30 days"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Month" icon="terp-go-today"
                            name="groupby_date_begin"
                            domain="[]"
                            context="{'group_by': 'date_begin'}"/>
                        <filter string="Day" icon="terp-go-today"
                            name="groupby_day"
                            domain="['|',
                                     ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                     ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                     '|',
                                     ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                     ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                     ]"
                             context="{'group_by': 'day'}"
                             help="Group by day in +- 10 days."/>
                        <filter string="QoQa Shop" domain="[]"
                            name="groupby_qoqa_shop_id"
                            context="{'group_by': 'qoqa_shop_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_qoqa_offer_tree" model="ir.ui.view">
            <field name="name">qoqa.offer.tree</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <tree string="QoQa Offer" fonts="bold:message_unread==True" colors="not grey:active;blue:date_begin &gt; current_date and date_end &lt; current_date">
                    <field name="message_unread" invisible="1"/>
                    <field name="date_begin" invisible="1"/>
                    <field name="time_begin" invisible="1"/>
                    <field name="date_end" invisible="1"/>
                    <field name="time_end" invisible="1"/>
                    <field name="day" invisible="1"/>
                    <field name="datetime_begin"/>
                    <field name="datetime_end"/>
                    <field name="qoqa_shop_id"/>
                    <field name="date_begin" invisible="1"/>
                    <field name="name"/>
                    <field name="title"/>
                    <field name="stock_is_online"/>
                    <field name="stock_progress" widget="progressbar"/>
                    <field name="active" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- Offer Kanban View  -->
        <record model="ir.ui.view" id="view_qoqa_offer_kanban">
            <field name="name">Offers Kanban</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <kanban default_group_by="qoqa_shop_id"
                      edit="false" quick_create="false" version="7.0">
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <field name="datetime_begin"/>
                    <field name="datetime_end"/>
                    <field name="day"/>
                    <field name="ref"/>
                    <field name="main_brand"/>
                    <field name="main_product_name"/>
                    <field name="description"/>
                    <field name="position_ids"/>
                    <field name="pricelist_id"/>
                    <field name="qoqa_shop_id"/>
                    <field name="lang_id"/>
                    <field name="sum_quantity"/>
                    <field name="sum_stock_sold"/>
                    <field name="stock_progress"/>
                    <field name="stock_bias"/>
                    <field name="stock_progress_with_bias"/>
                    <field name="shop_kanban_image"/>
                    <field name="main_lot_price"/>
                    <field name="main_regular_price"/>
                    <field name="currency_symbol"/>
                    <field name="stock_is_online"/>
                    <field name="stock_online_failure"/>
                    <field name="stock_reserved"/>
                    <field name="stock_reserved_percent"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_offer oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <img t-att-src="kanban_image('qoqa.offer', 'shop_kanban_image', record.id.value)"
                                            class="oe_kanban_image oe_qoqa_shop"/>
                                    <div class="header">
                                        <div class="qoqa_ref">
                                          <b><t t-if="record.lang_id.raw_value">[<field name="lang_id"/>]</t>
                                             <field name="ref"/></b>
                                        </div>
                                    </div>
                                    <div class="qoqa_name">
                                        <img t-att-src="kanban_image('qoqa.offer', 'image_small', record.id.value)"
                                                class="oe_kanban_image"/>
                                        <span class="qoqa_main_brand"><field name="main_brand"/></span>
                                        <field name="main_product_name"/>
                                    </div>
                                    <div class="oe_clear"></div>
                                    <div class="qoqa_content">
                                        <div class="qoqa_box">
                                            <div class="qoqa_left_box">
                                                <field name="main_lot_price"/> <field name="currency_symbol"/>
                                                <t t-esc="'('"/><field name="main_regular_price"/> <field name="currency_symbol"/><t t-esc="')'"/>
                                            </div>
                                            <div class="qoqa_right_box">

                                            </div>
                                        </div>
                                        <div class="qoqa_box">
                                            <span class="oe_e oe_left">
                                                <t t-if="record.stock_online_failure.value">&#81;</t>
                                                <t t-if="record.stock_is_online.value and !record.stock_online_failure.value">&#8646;</t>
                                                <t t-if="!record.stock_is_online.value and !record.stock_online_failure.value">&#124;</t>
                                            </span>
                                            <progress t-att-value="record.stock_progress.raw_value" max="100" class="qoqa_progress"/>
                                        </div>
                                        <div class="qoqa_box">
                                            <div class="qoqa_left_box">
                                              Stock: <b><field name="sum_stock_sold"/>/<field name="sum_quantity"/></b>
                                              <t t-esc="'('"/><field name="stock_progress_remaining"/>％<t t-esc="')'"/>
                                            </div>
                                            <div class="qoqa_right_box">
                                              <t t-if="record.stock_is_online.value and !record.stock_online_failure.value">
                                              Reserved: <b><field name="stock_reserved"/></b>
                                              <t t-esc="'('"/><field name="stock_reserved_percent"/>％<t t-esc="')'"/>
                                              </t>
                                            </div>
                                        </div>
                                        <hr class="qoqa_line"/>
                                        <div class="qoqa_box qoqa_middle">
                                            <div class="qoqa_left_box">
                                              Bias: <field name="stock_bias"/>％
                                            </div>
                                            <div class="qoqa_right_box">
                                              With bias: <b><field name="stock_progress_with_bias"/>％</b>
                                              <a name="decrement_stock_bias" type="object" class="qoqa_minus"></a>
                                            </div>
                                        </div>
                                        <hr class="qoqa_line"/>
                                        <div class="qoqa_box">
                                            <div class="qoqa_left_box qoqa_box_2lines">
                                                <b>Start</b><br/>
                                                <field name="datetime_begin"/>
                                            </div>
                                            <div class="qoqa_right_box qoqa_box_2lines">
                                                <b>End</b><br/>
                                                <field name="datetime_end"/>
                                            </div>
                                        </div>
                                        <div class="oe_clear"></div>
                                        <div class="qoqa_buttons" groups="base.group_user">
                                            <a name="action_view_sale_order" type="object" class="oe_kanban_button">Open Sales Orders</a>
                                        </div>
                                    </div>
                                    <div class="oe_clear"></div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_qoqa_offer_form" model="ir.ui.view">
            <field name="name">qoqa.offer.form</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <form string="Offer" version="7.0">
                    <header>
                        <button name="action_view_sale_order"
                            string="View Sales Orders" type="object"
                            groups="base.group_user"/>
                    </header>
                    <sheet>
                        <field name="image_medium" widget="image"
                            class="oe_avatar oe_left"/>
                        <div class="oe_title">
                            <div class="oe_edit_only">
                                <label for="name"/>
                            </div>
                            <h1>
                                <field name="name" class="oe_inline"/>
                            </h1>
                        </div>
                        <div class="oe_right oe_button_box" name="buttons">
                          <button name="button_orderpoint"
                              string="Compute Stock Minimum Rules" type="object"/>
                        </div>
                        <group>
                            <group name="content" string="Content">
                                <field name="title"/>
                                <field name="description" colspan="2" nolabel="1"/>
                            </group>
                            <group col="1">
                                <group name="configuration" string="Configuration">
                                    <field name="qoqa_shop_id" widget="selection"/>
                                    <label for="date_begin" string="Dates"/>
                                    <div>
                                        <field name="date_begin" class="oe_inline"
                                            on_change="onchange_date_begin(date_begin)"
                                            /><field name="time_begin" widget="float_time" class="oe_inline"/> - 
                                        <field name="date_end" class="oe_inline"/><field name="time_end" widget="float_time" class="oe_inline"/>
                                    </div>
                                    <field name="carrier_id"/>
                                    <field name="shipper_rate_id"/>
                                    <field name="company_id" invisible="1"/>
                                    <field name="pricelist_id"/>
                                    <field name="lang_id" widget="selection"/>
                                    <field name="active"/>
                                </group>
                            </group>
                        </group>
                        <notebook>
                            <page string="Positions">
                                <group>
                                    <field name="stock_bias"/>
                                    <newline/>
                                    <field name="position_ids" nolabel="1"
                                      context="{'date_begin': date_begin, 'time_begin': time_begin}"
                                      colspan="4">
                                        <tree string="Positions">
                                            <field name="sequence" widget="handle"/>
                                            <field name="product_tmpl_id"/>
                                            <field name="lot_price"/>
                                            <field name="sum_quantity"/>
                                            <field name="sum_stock_sold"/>
                                            <field name="stock_progress" widget="progressbar"/>
                                            <field name="active"/>
                                        </tree>
                                        <form string="Position" version="7.0">
                                            <field name="image_medium" widget="image"
                                                class="oe_avatar oe_left"/>
                                            <div>
                                                <label for="product_tmpl_id"/>
                                            </div>
                                            <h1>
                                                <field name="product_tmpl_id"
                                                    on_change="onchange_product_tmpl_id(product_tmpl_id, lot_size, parent.date_begin, parent.time_begin)"/>
                                            </h1>
                                            <notebook>
                                                <page string="Options">
                                                    <group>
                                                        <group name="price" string="Prices">
                                                            <field name="currency_id" invisible="1"/>
                                                            <field name="current_unit_price"
                                                                on_change="onchange_current_price(current_unit_price, lot_size)"
                                                                widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="unit_price"
                                                                widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="lot_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="installment_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="regular_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="regular_price_type"/>
                                                            <field name="buy_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="top_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                            <field name="tax_id"/>
                                                        </group>
                                                        <group>
                                                            <group name="stock" string="Stock" colspan="4">
                                                                <field name="lot_size"
                                                                    on_change="onchange_current_price(current_unit_price, lot_size)"/>
                                                                <field name="max_sellable"/>
                                                            </group>
                                                            <group name="various" string="Various" colspan="4">
                                                                <field name="date_delivery"/>
                                                                <field name="booking_delivery"/>
                                                                <field name="poste_cumbersome_package"/>
                                                                <field name="order_url"/>
                                                                <field name="active"/>
                                                            </group>
                                                        </group>
                                                    </group>
                                                </page>

                                                <page string="Descriptions">
                                                    <group name="description" string="Description" colspan="2">
                                                        <field name="description" nolabel="1"/>
                                                    </group>
                                                    <group name="highlights" string="Highlights" colspan="2">
                                                        <field name="highlights" nolabel="1"/>
                                                    </group>
                                                    <group colspan="4" name="buyphrase" string="Buyphrase">
                                                        <field name="buyphrase_id" nolabel="1"
                                                            colspan="4"/>
                                                    </group>
                                                </page>

                                                <page string="Stock">
                                                  <group>
                                                    <field name="stock_is_online"/>
                                                    <field name="stock_online_failure" invisible="1"/>
                                                    <field name="stock_online_failure_message" attrs="{'invisible': [('stock_online_failure', '=', False)]}"/>
                                                    <field name="stock_progress" widget="progressbar"/>
                                                    <field name="sum_quantity"/>
                                                    <field name="sum_stock_sold"/>
                                                    <field name="sum_residual"/>
                                                    <field name="stock_reserved" attrs="{'invisible': [('stock_is_online', '=', False)]}"/>
                                                    <field name="stock_reserved_percent" widget="progressbar" attrs="{'invisible': [('stock_is_online', '=', False)]}"/>
                                                  </group>
                                                </page>
                                            </notebook>
                                            <group colspan="4" name="variant" string="Variants">
                                                <field name="variant_ids" nolabel="1">
                                                    <tree string="Variants" editable="bottom">
                                                        <field name="sequence" widget="handle"/>
                                                        <field name="product_id"
                                                            domain="[('product_tmpl_id', '=', parent.product_tmpl_id)]"/>
                                                        <field name="quantity"/>
                                                        <field name="stock_sold"/>
                                                        <field name="stock_residual"/>
                                                        <field name="stock_progress" widget="progressbar"/>
                                                    </tree>
                                                </field>
                                            </group>
                                        </form>
                                    </field>
                                </group>
                            </page>
                            <page string="Internal Description">
                                <group>
                                    <field name="note" nolabel="1"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- QoQa Offer  Calendar  View -->

        <record id="view_qoqa_offer_calendar" model="ir.ui.view">
            <field name="name">qoqa.offer.calendar</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
              <calendar color="qoqa_shop_id" date_start="date_begin_calendar" date_stop="date_end_calendar" string="Offers">
                    <field name="name"/>
                    <field name="qoqa_shop_id"/>
                </calendar>
            </field>
        </record>

        <record id="action_offer" model="ir.actions.act_window">
            <field name="name">Offers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">qoqa.offer</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form,calendar</field>
            <field name="context">{'search_default_groupby_days': 1,
                                   'search_default_current': 1}</field>
            <field name="domain">[]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new offer.
              </p>
            </field>
        </record>

        <menuitem
            id="menu_qoqa_offer"
            name="Offers"
            parent="base.menu_sales"
            sequence="10" action="action_offer"/>

        <menuitem
            id="menu_qoqa_offer_config"
            name="Offers"
            parent="base.menu_base_config"
            sequence="90"/>

    </data>
</openerp>
