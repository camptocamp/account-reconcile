<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_sales_deal_filter" model="ir.ui.view">
            <field name="name">qoqa.deal.list.select</field>
            <field name="model">qoqa.deal</field>
            <field name="arch" type="xml">
                <search string="Search Sales Deal">
                    <field name="name" string="Sales Deal"
                        filter_domain="['|', ('name', '=', self),
                        ('product_tmpl_id.name', 'ilike', self)]"/>
                    <filter icon="terp-mail-message-new"
                        string="Unread Messages" name="message_unread"
                        domain="[('message_unread', '=', True)]"/>
                    <separator/>
                    <field name="product_tmpl_id"/>
                    <filter icon="terp-document-new"
                        string="Proposal"
                        name="draft"
                        domain="[('state', '=', 'draft')]"
                        help="Sales Deal that haven't yet been confirmed"/>
                    <filter icon="terp-check"
                        string="Negociation"
                        name="open"
                        domain="[('state', '=', 'open')]"/>
                    <filter icon="terp-dolar_ok!"
                        string="Planned"
                        domain="[('state', '=', 'planned')]"
                        help="Sales Deals Ready"/>
                    <filter icon="terp-dolar_ok!"
                        string="Done"
                        domain="[('state', '=', 'done')]"
                        help="Sales Deals done"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Status"
                            icon="terp-stock_effects-object-colorize"
                            domain="[]"
                            context="{'group_by': 'state'}"/>
                        <filter string="Day" icon="terp-go-today"
                            name="groupby_day"
                            domain="[]"
                            context="{'group_by': 'day'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_qoqa_deal_tree" model="ir.ui.view">
            <field name="name">qoqa.deal.tree</field>
            <field name="model">qoqa.deal</field>
            <field name="arch" type="xml">
                <tree string="QoQa Deal" fonts="bold:message_unread==True" colors="grey:state=='cancel';blue:state in ('draft', 'open');red:date_begin &gt; current_date and date_end &lt; current_date">
                    <field name="message_unread" invisible="1"/>
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <field name="day" invisible="1"/>
                    <field name="name"/>
                    <field name="product_tmpl_id"/>
                    <field name="sum_stock_available"/>
                    <field name="sum_stock_sold"/>
                    <field name="stock_progress" widget="progressbar"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Deal Kanban View  -->

        <record model="ir.ui.view" id="view_qoqa_deal_kanban">
            <field name="name">Deals Kanban</field>
            <field name="model">qoqa.deal</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <field name="name"/>
                    <field name="image"/>
                    <field name="stock_progress"/>
                    <field name="sum_stock_available"/>
                    <field name="sum_stock_sold"/>
                    <field name="variant_ids"/>
                    <field name="price_sale"/>
                    <field name="price_recommended"/>
                    <field name="product_tmpl_id"/>
                    <field name="currency_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <!--<div class="oe_kanban_vignette oe_semantic_html_override">-->
                            <div t-attf-class="oe_kanban_card oe_kanban_deal oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <h1>
                                        <!--<a type="open">-->
                                            <field name="name"/>
                                        <!--</a>-->
                                    </h1>
                                    <h4>
                                        <!--<a type="open">-->
                                            <span>
                                                <div class="qoqa_date_left">
                                                    <b>Start</b><br />
                                                    <field name="date_begin"/>
                                                </div>
                                                <div class="qoqa_date_right">
                                                    <b>End</b><br />
                                                    <field name="date_end"/>
                                                </div>
                                            </span>
                                        <!--</a>-->
                                    </h4>
                                    <div>
                                        <!--<a type="open">-->
                                            <field name="shipping_type"/>
                                        <!--</a>-->
                                    </div>
                                    <hr/>
                                    <div>
                                        <!--<a type="open">-->
                                            <img t-att-src="kanban_image('qoqa.deal', 'image', record.id.value)" class="oe_kanban_image qoqa_deal_image"/>
                                            <ul>
                                                <li><b><field name="product_tmpl_id"/></b></li>
                                                <li><field name="currency_id"/> <field name="price_sale"/> ( <field name="currency_id"/> <field name="price_recommended"/> )</li>
                                            </ul>
                                        <!--</a>-->
                                    </div>
                                    <div>
                                        <progress t-att-value="record.stock_progress.raw_value" max="100"/>
                                        <div name="tags"/>
                                        <ul>
                                            <t t-if="record.variant_ids.raw_value.length gt 1">
                                                <li t-foreach="record.variant_ids.raw_value" t-as="variant">
                                                    Variants <b t-esc="variant_index"/>: Stock (Sold / Available)
                                                </li>
                                            </t>
                                            <li>Stock: <field name="sum_stock_sold"/> / <field name="sum_stock_available"/></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_qoqa_deal_form" model="ir.ui.view">
            <field name="name">qoqa.deal.form</field>
            <field name="model">qoqa.deal</field>
            <field name="arch" type="xml">
                <form string="Deal" version="7.0">
                    <header>
                        <button name="action_plan" string="Confirm"
                            type="object" class="oe_highlight"
                            states="draft,open" groups="base.group_user"/>
                        <button name="action_done" string="Close"
                            type="object" class="oe_highlight"
                            states="planned" groups="base.group_user"/>
                        <button name="action_cancel"
                            string="Cancel" type="object"
                            groups="base.group_user"
                            states="draft,open,planned"/>
                        <field name="state" widget="statusbar"
                            statusbar_visible="draft,open,planned,done"
                            statusbar_colors='{"cancel": "red"}'/>
                    </header>
                    <sheet>
                        <field name="image" widget="image"
                            class="oe_avatar oe_left"/>
                        <div class="oe_title">
                            <div class="oe_edit_only">
                                <label for="product_tmpl_id"/>
                            </div>
                            <h1>
                                <field name="product_tmpl_id"
                                    on_change="onchange_product_tmpl_id(product_tmpl_id)"/>
                            </h1>
                            <group>
                                <field name="name" readonly="1"/>
                            </group>
                        </div>
                        <group>
                            <label for="date_begin" string="Dates"/>
                            <div>
                                <field name="date_begin" class="oe_inline"/> - 
                                <field name="date_end" class="oe_inline"/>
                            </div>
                        </group>
                        <div class="oe_right oe_button_box" name="buttons">
                        </div>
                        <group>
                            <group>
                                <field name="currency_id"/>
                                <field name="price_sale"/>
                                <field name="price_recommended"/>
                                <field name="price_observed"/>
                            </group>
                            <group>
                                <field name="shipping_type"/>
                                <field name="shipping_costs"/>
                                <field name="date_warranty"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Products">
                                <field name="variant_ids">
                                    <tree string="Variants" editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_id" domain="[('product_tmpl_id', '=', parent.product_tmpl_id)]"/>
                                        <field name="stock_available" sum="Available"/>
                                        <field name="stock_reserved" sum="Reserved"/>
                                        <field name="stock_sold" sum="Sold"/>
                                        <field name="stock_residual" sum="Remaining"/>
                                        <field name="stock_progress" widget="progressbar"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Indicators">
                                <group>
                                    <group name="delay" string="Delays">
                                        <label for="shipping_max_delay"/>
                                        <div>
                                            <field name="shipping_max_delay" class="oe_inline"/> days
                                        </div>
                                    </group>
                                </group>
                            </page>
                            <page string="Descriptions">
                                <separator string="Internal Description"/>
                                <field name="description" widget="html"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- QoQa Deal  Calendar  View -->

        <record id="view_qoqa_deal_calendar" model="ir.ui.view">
            <field name="name">qoqa.deal.calendar</field>
            <field name="model">qoqa.deal</field>
            <field name="arch" type="xml">
                <calendar color="name" date_start="date_begin" date_stop="date_end" string="Deals">
                    <field name="name"/>
                </calendar>
            </field>
        </record>

        <record id="action_deal" model="ir.actions.act_window">
            <field name="name">Deals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">qoqa.deal</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form,calendar</field>
            <field name="context">{}</field>
            <field name="domain">[('state', '!=', 'cancel')]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a deal in the planning.
              </p>
            </field>
        </record>

        <menuitem
            id="menu_qoqa_deal"
            name="Deals"
            parent="base.menu_sales"
            sequence="10" action="action_deal"/>
    </data>
</openerp>
