<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record id="view_sales_offer_filter" model="ir.ui.view">
            <field name="name">qoqa.offer.list.select</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <search string="Search Sales Offer">
                    <field name="name" string="Offer"/>
                    <field name="ref" string="Ref"/>
                    <field name="title" string="Title"/>
                    <field name="qoqa_shop_id" widget="selection"/>
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <filter icon="terp-mail-message-new"
                        string="Unread Messages" name="message_unread"
                        domain="[('message_unread', '=', True)]"/>
                    <separator/>

                    <filter
                        string="Within 10 days"
                        name="in10days"
                        domain="['|',
                                 ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 '|',
                                 ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=10)).strftime('%%Y-%%m-%%d')),
                                 ]"
                        help="Offers within 10 days"/>
                    <filter
                        string="Within 30 days"
                        name="in30days"
                        domain="['|',
                                 ('date_begin', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&gt;=', (context_today() - datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 '|',
                                 ('date_begin', '&lt;=', (context_today() + datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ('date_end', '&lt;=', (context_today() + datetime.timedelta(days=30)).strftime('%%Y-%%m-%%d')),
                                 ]"
                        help="Offers within 30 days"/>
                    <separator/>
                    <filter icon="terp-document-new"
                        string="Proposal"
                        name="draft"
                        domain="[('state', '=', 'draft')]"
                        help="Sales Offer that haven't yet been confirmed"/>
                    <filter icon="terp-check"
                        string="Negociation"
                        name="open"
                        domain="[('state', '=', 'open')]"/>
                    <filter icon="terp-dolar_ok!"
                        string="Planned"
                        domain="[('state', '=', 'planned')]"
                        help="Sales Offers Ready"/>
                    <filter icon="terp-dolar_ok!"
                        string="Done"
                        domain="[('state', '=', 'done')]"
                        help="Sales Offers done"/>
                    <separator/>
                    <group expand="0" string="Group By...">
                        <filter string="Status"
                            icon="terp-stock_effects-object-colorize"
                            domain="[]"
                            context="{'group_by': 'state'}"/>
                        <filter string="Month" icon="terp-go-today"
                            name="groupby_date_begin"
                            domain="[]"
                            context="{'group_by': 'date_begin'}"/>
                        <filter string="Day" icon="terp-go-today"
                            name="groupby_day"
                            domain="[]"
                            context="{'group_by': 'day'}"/>
                        <filter string="QoQa Shop" domain="[]"
                            name="groupby_qoqa_shop_id"
                            context="{'group_by': 'qoqa_shop_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="view_qoqa_offer_tree" model="ir.ui.view">
            <field name="name">qoqa.offer.tree</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <tree string="QoQa Offer" fonts="bold:message_unread==True" colors="grey:state=='cancel';blue:state in ('draft', 'open');red:date_begin &gt; current_date and date_end &lt; current_date">
                    <field name="message_unread" invisible="1"/>
                    <field name="date_begin" invisible="1"/>
                    <field name="time_begin" invisible="1"/>
                    <field name="date_end" invisible="1"/>
                    <field name="time_end" invisible="1"/>
                    <field name="day" invisible="1"/>
                    <field name="datetime_begin"/>
                    <field name="datetime_end"/>
                    <field name="qoqa_shop_id"/>
                    <field name="date_begin" invisible="1"/>
                    <field name="name"/>
                    <field name="title"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Offer Kanban View  -->
        <record model="ir.ui.view" id="view_qoqa_offer_kanban">
            <field name="name">Offers Kanban</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" version="7.0">
                    <field name="date_begin"/>
                    <field name="date_end"/>
                    <field name="datetime_begin"/>
                    <field name="datetime_end"/>
                    <field name="day"/>
                    <field name="ref"/>
                    <field name="name"/>
                    <field name="description"/>
                    <field name="position_ids"/>
                    <field name="pricelist_id" domain="[('type', '=', 'sale')]"/>
                    <field name="qoqa_shop_id"/>
                    <field name="lang_id"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_offer oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <img t-att-src="kanban_image('qoqa.offer', 'image_small', record.id.value)"
                                            class="oe_kanban_image"/>
                                    <div class="header">
                                        <b><field name="name"/></b>
                                    </div>
                                    <div class="dates">
                                        <field name="datetime_begin"/>  â†’
                                        <field name="datetime_end"/>
                                    </div>
                                    <div>
                                        <ul>
                                            <li><field name="qoqa_shop_id"/></li>
                                            <li><field name="lang_id"/></li>
                                        </ul>
                                    </div>
                                    <div class="oe_clear"></div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="view_qoqa_offer_form" model="ir.ui.view">
            <field name="name">qoqa.offer.form</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <form string="Offer" version="7.0">
                    <header>
                        <button name="action_plan" string="Confirm"
                            type="object" class="oe_highlight"
                            states="draft,open" groups="base.group_user"/>
                        <button name="action_done" string="Close"
                            type="object" class="oe_highlight"
                            states="planned" groups="base.group_user"/>
                        <button name="action_cancel"
                            string="Cancel" type="object"
                            groups="base.group_user"
                            states="draft,open,planned"/>
                        <field name="state" widget="statusbar"
                            statusbar_visible="draft,open,planned,done"
                            statusbar_colors='{"cancel": "red"}'/>
                    </header>
                    <sheet>
                        <field name="image_medium" widget="image"
                            class="oe_avatar oe_left"/>
                        <div class="oe_title">
                            <div class="oe_edit_only">
                                <label for="name"/>
                            </div>
                            <h1>
                                <field name="name" class="oe_inline"/>
                            </h1>
                        </div>
                        <div class="oe_right oe_button_box" name="buttons">
                        </div>
                        <group>
                            <group name="content" string="Content">
                                <field name="title"/>
                                <field name="description" colspan="2" nolabel="1"/>
                            </group>
                            <group name="configuration" string="Configuration">
                                <field name="qoqa_shop_id" widget="selection"/>
                                <label for="date_begin" string="Dates"/>
                                <div>
                                    <field name="date_begin" class="oe_inline"
                                        on_change="onchange_date_begin(date_begin)"
                                        /><field name="time_begin" widget="float_time" class="oe_inline"/> - 
                                    <field name="date_end" class="oe_inline"/><field name="time_end" widget="float_time" class="oe_inline"/>
                                </div>
                                <field name="shipper_service_id"/>
                                <field name="carrier_id"/>
                                <field name="pricelist_id" widget="selection"/>
                                <field name="lang_id" widget="selection"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Positions">
                                <field name="position_ids">
                                    <tree string="Positions">
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_tmpl_id"/>
                                        <field name="unit_price"/>
                                        <field name="sum_quantity"/>
                                        <field name="sum_stock_sold"/>
                                        <field name="stock_progress" widget="progressbar"/>
                                    </tree>
                                    <form string="Position" version="7.0">
                                        <header>
                                            <field name="state" widget="statusbar" invisible="1"/>
                                        </header>
                                        <field name="image_medium" widget="image"
                                            class="oe_avatar oe_left"/>
                                        <div>
                                            <label for="product_tmpl_id"/>
                                        </div>
                                        <h1>
                                            <field name="product_tmpl_id"
                                                on_change="onchange_product_tmpl_id(product_tmpl_id)"/>
                                        </h1>
                                        <group>
                                            <group name="price" string="Prices">
                                                <field name="currency_id" invisible="1"/>
                                                <field name="unit_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                <field name="installment_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                <field name="regular_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                <field name="regular_price_type"/>
                                                <field name="buy_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                <field name="top_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                                <field name="tax_id" on_change="onchange_tax_id(tax_id)"/>
                                                <field name="is_net_price"/>
                                                <field name="ecotax"/>
                                            </group>
                                            <group>
                                                <group name="stock" string="Stock" colspan="4">
                                                    <field name="lot_size"/>
                                                    <field name="max_sellable"/>
                                                    <field name="stock_bias"/>
                                                </group>
                                                <group name="various" string="Various" colspan="4">
                                                    <field name="date_delivery"/>
                                                    <field name="booking_delivery"/>
                                                    <field name="order_url"/>
                                                </group>
                                            </group>
                                        </group>
                                        <group colspan="4" name="buyphrase" string="Buyphrase">
                                            <field name="buyphrase_id" nolabel="1"
                                                options='{"no_open": 1}'
                                                colspan="4"/>
                                        </group>
                                        <group colspan="4" name="variant" string="Variants">
                                            <field name="variant_ids" nolabel="1">
                                                <tree string="Variants" editable="bottom">
                                                    <field name="product_id"
                                                        domain="[('product_tmpl_id', '=', parent.product_tmpl_id)]"/>
                                                    <field name="quantity"/>
                                                    <field name="stock_sold"/>
                                                    <field name="stock_residual"/>
                                                    <field name="stock_progress" widget="progressbar"/>
                                                </tree>
                                            </field>
                                        </group>
                                    </form>
                                </field>
                            </page>
                            <page string="Internal Description">
                                <group>
                                    <field name="note" nolabel="1"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- QoQa Offer  Calendar  View -->

        <record id="view_qoqa_offer_calendar" model="ir.ui.view">
            <field name="name">qoqa.offer.calendar</field>
            <field name="model">qoqa.offer</field>
            <field name="arch" type="xml">
                <calendar color="qoqa_shop_id" date_start="date_begin" date_stop="date_end" string="Offers">
                    <field name="name"/>
                    <field name="qoqa_shop_id"/>
                </calendar>
            </field>
        </record>

        <record id="action_offer" model="ir.actions.act_window">
            <field name="name">Offers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">qoqa.offer</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form,calendar</field>
            <field name="context">{}</field>
            <field name="domain">[('state', '!=', 'cancel')]</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a new offer.
              </p>
            </field>
        </record>

        <menuitem
            id="menu_qoqa_offer"
            name="Offers"
            parent="base.menu_sales"
            sequence="10" action="action_offer"/>

        <menuitem
            id="menu_qoqa_offer_config"
            name="Offers"
            parent="base.menu_base_config"
            sequence="90"/>

    </data>
</openerp>
