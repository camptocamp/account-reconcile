<!DOCTYPE html SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <style type="text/css">
${css}
/* Official */
.act_as_table {
  display: table;
}
.act_as_thead {
  display: table-header-group;
}
.act_as_tbody {
  display: table-row-group;
}
.act_as_tfoot {
  display: table-footer-group;
}
.act_as_row {
  display:table-row;
}
.act_as_cell {
  display: table-cell;
  border-left: 1px solid grey;
}
.list_table, .data_table {
  width: 1080px;
  table-layout: fixed
}
.title {
  font-size: 16px;
  font-weight: bold;
  text-align: left;
}
.title2 {
  font-size: 12px;
  font-weight: bold;
  text-align: left;
  padding-left: 20px;
}
.title3 {
  text-align: left;
  padding-left: 40px;
}
.amount {
  text-align: right;
  white-space: nowrap;
  padding-right: 20px;
}
/***********/
.labels {
  background-color: #EEEEEE;
  font-weight:bold;
  padding-right:3px;
  padding-left:3px;
  white-space:nowrap;
  background-clip:border-box;
}
.list_table.act_as_cell {
  text-align:left;
  font-size:12;
  padding-right:3px;
  padding-left:3px;
  padding-top:3px;
  padding-bottom:3px;
  white-space:nowrap;
  display:table-cell;
}

.total_empty_cell {
  border: 0;
  border-top: 1px solid grey;
}
.total_sum_label_cell {
  border: 0;
  border-top: 1px solid grey;
  padding-top: 10px;
}
.total_sum_cell {
  border: 0;
  border-top: 3px solid grey;
  padding-top: 10px;
}
.sub_total_col {
  border-left: 2px solid grey;
}
.sub_total_cell {
  border-bottom: 2px solid grey;
}
.line_grp1 {
  background-color: lightGrey;
}
.line_grp2 {
  background-color: white;
}
    </style>
  </head>
  <body>
    <%!
    def amount(text):
        return text.replace('-', '&#8209;')  # replace by a non-breaking hyphen (it will not word-wrap between hyphen and numbers)
    %>

    <%setLang(user.lang)%>

    <h1>${_('Wine Inventory')} ${formatLang(inventory_date, date=True)}</h1>

    <div class="act_as_table list_table" style="margin-top:5px;">
      <% total_volume = 0.0 %>
      <div class="act_as_thead labels">
        <div class="act_as_row">
          <div class="act_as_cell"></div>
          <div class="act_as_cell" style="width: 30%;"></div>
          %for b in wine_bottles:
              <div class="act_as_cell amount">${format_volume(b)}</div>
          %endfor
          <div class="act_as_cell sub_total_col amount">${_('Total')}</div>
          <div class="act_as_cell"></div>
        </div>
      </div>
        <% alternated_color = 0 %>
        %for wine_class in wine_classes:
            <div class="act_as_tbody line_grp${alternated_color}">
            <%doc>
                Print a wine class line filling by empty cells the table
            </%doc>
            %if wine_class.child_ids or not wine_class.parent_id:
                <div class="act_as_row labels">
                  <div class="act_as_cell title">${wine_class.code}</div>
                  <div class="act_as_cell title">${wine_class.name}</div>
                  %for b in range(len(wine_bottles)):
                      <div class="act_as_cell" style="width: 70px;"></div>
                  %endfor
                  <div class="act_as_cell sub_total_col " style="width: 70px;"></div>
                  <div class="act_as_cell" style="width: 70px;"></div>
                </div>
            %endif
            %if not wine_class.child_ids:
                <% alternated_color = (alternated_color + 1) % 2 %>
                %for color in wine_types:
                    <%
                      class_total_volume = 0.0
                      wine_ids = get_wine_ids(wine_class.id, color.name)
                    %>
                    %if wine_ids:
                        <div class="act_as_row">
                          <div class="act_as_cell"></div>
                          <div class="act_as_cell title2">${wine_class.name}: ${color.name}</div>
                          %for b in range(len(wine_bottles)):
                              <div class="act_as_cell" style="width: 70px;"></div>
                          %endfor
                          <div class="act_as_cell sub_total_col " style="width: 70px;"></div>
                          <div class="act_as_cell" style="width: 70px;"></div>
                        </div>
                        %for p_id in wine_ids:
                            %if p_id in wine_lines:
                                <div class="act_as_row">
                                  <% p_name, stock, sum = wine_lines.get(p_id) %>
                                  <div class="act_as_cell"></div>
                                  <div class="act_as_cell title3" style="width: 70px;">${p_name}</div>
                                  %for b in wine_bottles:
                                      <div class="act_as_cell amount" style="width: 70px;">${stock.get(b, '')}</div>
                                  %endfor
                                  <% is_subtotal = p_id == wine_ids[-1] and len([w for w in wine_ids if w in wine_lines]) > 1 %>
                                  <div class="act_as_cell amount sub_total_col ${is_subtotal and 'sub_total_cell'}" style="width: 70px;">${sum}</div>
                                  <% class_total_volume += sum %>
                                  <div class="act_as_cell amount" style="width: 70px;">
                                  %if p_id == wine_ids[-1]:
                                      ${class_total_volume}
                                  %endif
                                  </div>
                                </div>
                            %endif
                        %endfor
                        <% total_volume += class_total_volume %>
                    %endif
                %endfor
                ## Add an empty row after a class and all its colors to give some space
                <div class="act_as_row">
                  %for b in range(len(wine_bottles)+2):
                      <div class="act_as_cell">&nbsp;</div>
                  %endfor
                  <div class="act_as_cell sub_total_col">&nbsp;</div>
                  <div class="act_as_cell">&nbsp;</div>
                </div>
            %endif
        </div>
        %endfor
      <div class="act_as_tfoot totals">
        <div class="act_as_row">
          %for b in range(len(wine_bottles)+2):
              <div class="act_as_cell total_empty_cell"></div>
          %endfor
          <div class="act_as_cell total_sum_label_cell">
              ${_("General Total:")}
          </div>
          <div class="act_as_cell amount total_sum_cell">
            <b>${total_volume}</b>
          </div>
        </div>
      </div>
    </div>


  </body>
</html>
